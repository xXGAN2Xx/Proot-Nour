      - name: Build (Gradle if present, else kotlinc via apt)
        id: build_step
        shell: bash
        run: |
          set -eo pipefail

          list_jars() {
            echo "=== Jar files found ==="
            find . -type f -name "*.jar" -print || true
            echo "=== end jars ==="
          }

          if [ -x "./gradlew" ]; then
            echo "Using ./gradlew to build"
            chmod +x ./gradlew
            ./gradlew clean assemble || ./gradlew clean build
            list_jars
            exit 0
          fi

          echo "No gradlew -> installing kotlin compiler via apt"
          sudo apt-get update
          sudo apt-get install -y kotlin

          KT_FILES=$(find wrappers -type f -name "*.kt" -print | tr '\n' ' ')
          if [ -z "$KT_FILES" ]; then
            echo "No .kt files found under wrappers/ - nothing to compile"
            exit 1
          fi

          mkdir -p build
          echo "Compiling: $KT_FILES"
          kotlinc $KT_FILES -include-runtime -d build/server.jar
          list_jars
